# WARNING: DO NOT EDIT!
#
# This file was generated by plugin_template, and is managed by bootstrap.py. Please use
# bootstrap.py to update this file.
#
# For more info visit https://github.com/pulp/plugin_template
---
name: Bugzilla Redmine
on:
  schedule:
    # * is a special character in YAML so you have to quote this string
    - cron: '0 */1 * * *'
jobs:
  redmine_bugzilla:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.7
        uses: actions/setup-python@v1
        with:
          python-version: '3.7'
      - name: Bugzilla automation script
        env:
          REDMINE_API_KEY: ${{ secrets.REDMINE_API_KEY }}
          BUGZILLA_API_KEY: ${{ secrets.BUGZILLA_API_KEY }}
        run: |
          pip install requests python-bugzilla python-redmine urllib3 pyopenssl
          python ./ci/redmine_bugzilla.py
      - name: After failure
        if: failure()
        run: |
          echo ::group::sendmail
          sudo apt-get update -yq
          sudo -E apt-get -yq --no-install-suggests --no-install-recommends install sendmail
          pip install dynaconf
          sudo systemctl restart sendmail
          echo ::endgroup::
          python .github/send_email.py
